# 车道线结构化编码中采样策略设计与实现

## 1. 采样高度策略（sample_ys_mode）

在结构化车道线编码过程中，需要将连续车道线几何曲线映射至一组离散的纵向采样高度 $y_i$，并在对应高度处提取横向位置 $x_i$，从而形成结构化回归向量。本工作设计了三种采样高度生成模式（sample_ys_mode），以适应不同分布特性与建模需求。

### 1.1 等间隔采样（equal_interval）

等间隔采样在图像垂直方向 $[0, H)$ 内均匀生成采样高度：

\[
y_i = H - 1 - i \cdot \frac{H - 1}{N - 1}, \quad i = 0, 1, \dots, N-1
\]

其中：
- $H$ 表示输入图像高度；
- $N$ 表示采样点数量。

该方式具有实现简单、覆盖整幅图像范围的优点，但忽略了车道线在不同高度区域的实际分布特性，在远处区域可能存在信息冗余，而在近处区域采样密度不足。

---

### 1.2 等密度采样（equal_density）

等密度采样基于数据统计先验，在训练集上统计车道线在垂直方向的分布密度，并据此构造非均匀采样高度序列：

\[
\{y_i\}_{i=1}^N = \mathcal{S}_{\text{stat}}
\]

其中 $\mathcal{S}_{\text{stat}}$ 表示依据真实数据分布预定义的采样高度集合。该策略在近距离区域分配更多采样点，在远距离区域减少采样密度，有助于提升对近场复杂几何结构的建模精度。

---

### 1.3 车道自适应采样（lane_adaptive）

车道自适应采样仅在车道线真实覆盖的纵向范围内进行采样，避免对空区域进行无效建模：

\[
y_i = y_{\text{start}} - i \cdot \frac{y_{\text{start}} - y_{\text{end}}}{N - 1}, \quad i = 0, \dots, N-1
\]

其中：
- $y_{\text{start}}$ 和 $y_{\text{end}}$ 分别表示车道线在图像坐标系中的起点与终点纵坐标。

该方式能够有效减少无效采样点比例，提升编码效率，特别适用于短车道线或部分可见车道线场景。

---

## 2. 车道曲线采样方式（sample_lane_mode）

在获得采样高度 $y_i$ 后，需要从原始车道线标注点 $\{(x_j, y_j)\}$ 中计算对应的横坐标 $x_i$。本工作设计了两种采样方式。

---

### 2.1 基于纵坐标线性插值（linear_interp）

该方式直接将原始车道线视为函数 $x = f(y)$，并采用一维线性插值：

\[
x_i = \text{Interp}(y_i; \{(y_j, x_j)\})
\]

该方法实现简单、计算效率高，但在车道线曲率变化较大或标注点分布不均匀时，易引入局部几何误差，导致采样点分布在高曲率区域不均匀。

---

### 2.2 基于弧长参数化的均匀采样（arc_length）

为克服线性插值在几何空间中的不足，本方法引入弧长参数化，对车道线进行几何一致的重采样。首先计算原始车道折线的累计弧长：

\[
s_0 = 0, \quad
s_k = \sum_{i=1}^{k} \left\| \mathbf{p}_i - \mathbf{p}_{i-1} \right\|_2
\]

其中 $\mathbf{p}_i = (x_i, y_i)$ 表示第 $i$ 个标注点。

随后在区间 $[0, s_{\text{total}}]$ 上均匀采样：

\[
s_i^{\prime} = i \cdot \frac{s_{\text{total}}}{N - 1}, \quad i = 0, \dots, N-1
\]

对于每一个目标弧长 $s_i^{\prime}$，在原始折线段上进行逐段定位，并在对应线段内进行线性插值：

\[
\mathbf{p}(s_i^{\prime}) 
= \mathbf{p}_k + \frac{s_i^{\prime} - s_k}{s_{k+1} - s_k} (\mathbf{p}_{k+1} - \mathbf{p}_k)
\]

该方式保证重采样点严格位于原始折线几何结构上，显著提升了在高曲率区域的几何一致性与重建精度。

---

## 3. 采样策略对结构化编码精度的影响

综合不同采样高度策略与车道采样方式，结构化编码器可形成多种组合配置。实验表明：

- 等弧长采样在弯道与复杂几何区域显著优于直接纵坐标插值；
- 自适应纵向采样高度有助于减少无效建模区域，提高编码有效性；
- 基于几何一致逐段插值的弧长采样方式，在编码精度与后续回归稳定性方面均表现出更优性能。

因此，在本工作中，推荐采用 **arc_length + lane_adaptive** 的组合配置，以兼顾几何精度与计算效率。
